var canvas=document.getElementById("cesaro");canvas.style.position="absolute",canvas.style.left="50%",canvas.style.transform="translate(-50%, 0)";var ctx=canvas.getContext("2d"),baseMotif=document.getElementById("base-motif"),bMctx=baseMotif.getContext("2d"),bxmin=-1,bxmax=1,bymin=-1,bymax=1,bwidth=450,bheight=450,btransx=0,btransy=62,mxmin=-1,mxmax=1,mymin=-1,mymax=1,mwidth=450,mheight=450,mtransx=512,mtransy=62,axesColor="rgba(0,0,0,1)",thickLineColor="rgba(0,0,0,0.5)",thinLineColor="rgba(0,0,0,0.2)",zoomrate=1.04,titleFont="20px Cambria",axisFont="14px Cambria";function decimalAdjust(f,g,h){return"undefined"==typeof h||0==+h?Math[f](g):(g=+g,h=+h,isNaN(g)||"number"!=typeof h||0!=h%1)?NaN:0>g?-decimalAdjust(f,-g,h):(g=g.toString().split("e"),g=Math[f](+(g[0]+"e"+(g[1]?+g[1]-h:-h))),g=g.toString().split("e"),+(g[0]+"e"+(g[1]?+g[1]+h:h)))}function isNormalInteger(f){var g=Math.floor(+f);return g+""===f&&0<=g}Math.round10||(Math.round10=function(f,g){return decimalAdjust("round",f,g)}),Math.floor10||(Math.floor10=function(f,g){return decimalAdjust("floor",f,g)}),Math.ceil10||(Math.ceil10=function(f,g){return decimalAdjust("ceil",f,g)}),String.prototype.trimLeft=function(f){return void 0===f&&(f="s"),this.replace(new RegExp("^["+f+"]+"),"")},String.prototype.trimRight=function(f){return void 0===f&&(f="s"),this.replace(new RegExp("["+f+"]+$"),"")},String.prototype.trim=function(f){return this.trimLeft(f).trimRight(f)};function clearBMCanvas(){bMctx.clearRect(0,0,baseMotif.width,baseMotif.height)}var lastX=450,lastY=450;baseMotif.onwheel=function(f){var g=f.wheelDelta?f.wheelDelta/40:f.detail?-f.detail:0;g&&(bZoom(f.offsetX,f.offsetY,g,f),mZoom(f.offsetX,f.offsetY,g,f)),redrawBM()};var bdragStartX,bdragStartY,tempbxmin,tempbymin,tempbxmax,tempbymax,mdragStartX,mdragStartY,tempmxmin,tempmymin,tempmxmax,tempmymax;baseMotif.addEventListener("mousedown",function(f){lastX<btransx||lastX>btransx+bwidth||lastY<btransy||lastY>btransy+bheight||(document.body.style.mozUserSelect=document.body.style.webkitUserSelect=document.body.style.userSelect="none",lastX=f.offsetX||f.pageX-baseMotif.offsetLeft,lastY=f.offsetY||f.pageY-baseMotif.offsetTop,bdragStartX=(lastX-btransx)/bwidth*(bxmax-bxmin)+bxmin,bdragStartY=(bheight-lastY+btransy)/bheight*(bymax-bymin)+bymin,tempbxmin=bxmin,tempbymin=bymin,tempbxmax=bxmax,tempbymax=bymax),lastX<mtransx||lastX>mtransx+mwidth||lastY<mtransy||lastY>mtransy+mheight||(document.body.style.mozUserSelect=document.body.style.webkitUserSelect=document.body.style.userSelect="none",lastX=f.offsetX||f.pageX-baseMotif.offsetLeft,lastY=f.offsetY||f.pageY-baseMotif.offsetTop,mdragStartX=(lastX-mtransx)/mwidth*(mxmax-mxmin)+mxmin,mdragStartY=(mheight-lastY+mtransy)/mheight*(mymax-mymin)+mymin,tempmxmin=mxmin,tempmymin=mymin,tempmxmax=mxmax,tempmymax=mymax)},!1),baseMotif.addEventListener("mousemove",function(f){if(lastX=f.offsetX||f.pageX-baseMotif.offsetLeft,lastY=f.offsetY||f.pageY-baseMotif.offsetTop,dragged=!0,bdragStartX){var g=(lastX-btransx)/bwidth*(tempbxmax-tempbxmin)+tempbxmin,h=(bheight-lastY+btransy)/bheight*(tempbymax-tempbymin)+tempbymin;if(-1e3>tempbxmin-g+bdragStartX||1e3<tempbxmax-g+bdragStartX||-1e3>tempbymin-h+bdragStartY||1e3<tempbymax-h+bdragStartY)return;bxmin=tempbxmin-g+bdragStartX,bymin=tempbymin-h+bdragStartY,bxmax=tempbxmax-g+bdragStartX,bymax=tempbymax-h+bdragStartY}if(mdragStartX){var g=(lastX-mtransx)/mwidth*(tempmxmax-tempmxmin)+tempmxmin,h=(mheight-lastY+mtransy)/mheight*(tempmymax-tempmymin)+tempmymin;if(-1e3>tempmxmin-g+mdragStartX||1e3<tempmxmax-g+mdragStartX||-1e3>tempmymin-h+mdragStartY||1e3<tempmymax-h+mdragStartY)return;mxmin=tempmxmin-g+mdragStartX,mymin=tempmymin-h+mdragStartY,mxmax=tempmxmax-g+mdragStartX,mymax=tempmymax-h+mdragStartY}redrawBM()},!1),baseMotif.addEventListener("mouseup",function(){bdragStartX=null,bdragStartY=null,mdragStartX=null,mdragStartY=null},!1);function resetBZoom(){bxmin=-1,bxmax=1,bymin=-1,bymax=1,redrawBM()}function bZoom(f,g,h,j){if(!((-1e3>bxmin||1e3<bxmax||-1e3>bymin||1e3<bymax)&&0<h||1e-3>bxmax-bxmin&&0>h)&&!(f<btransx||f>btransx+bwidth||g<btransy||g>btransy+bheight)){j.preventDefault();var l=(f-btransx)/bwidth*(bxmax-bxmin)+bxmin,m=(bheight-g+btransy)/bheight*(bymax-bymin)+bymin;bxmin=Math.pow(zoomrate,h)*(bxmin-l)+l,bxmax=Math.pow(zoomrate,h)*(bxmax-l)+l,bymin=Math.pow(zoomrate,h)*(bymin-m)+m,bymax=Math.pow(zoomrate,h)*(bymax-m)+m}}function bLine(f,g,h,j){return bMctx.strokeStyle="#FF0000",bMctx.lineWidth=2,bMctx.save(),bMctx.beginPath(),bMctx.moveTo(btransx,btransy),bMctx.lineTo(btransx+bwidth,btransy),bMctx.lineTo(btransx+bwidth,btransy+bwidth),bMctx.lineTo(btransx,btransy+bwidth),bMctx.lineTo(btransx,btransy),bMctx.clip(),bMctx.beginPath(),bMctx.moveTo(bwidth*(f-bxmin)/(bxmax-bxmin)+btransx,bheight*(1-(g-bymin)/(bymax-bymin))+btransy),bMctx.lineTo(bwidth*(h-bxmin)/(bxmax-bxmin)+btransx,bheight*(1-(j-bymin)/(bymax-bymin))+btransy),bMctx.stroke(),bMctx.lineWidth=1,void bMctx.restore()}function drawBaseGrid(){bMctx.textAlign="left",bMctx.font=titleFont,bMctx.fillText("Base Curve",btransx+10,40),bMctx.font=axisFont;var f=Math.floor(Math.log10(bxmax-bxmin))-1,g=Math.pow(10,f);for(i=Math.round10(bxmin,f)+g;i<Math.round10(bxmax,f)-g/2;i+=g){var h=Math.round(mwidth*(i-bxmin)/(bxmax-bxmin))+btransx+0.5,j=!1;if(bMctx.lineWidth=1,Math.abs(i)<g/100?(bMctx.strokeStyle=axesColor,bMctx.lineWidth=2):Math.abs(Math.round10(i,f)-i)<g/100?(bMctx.strokeStyle=thickLineColor,j=!0,60*g<bymax-bymin?0.01<Math.abs(Math.abs(Math.round10(Math.abs(i),f)/g%10-5)-5)&&(j=!1,bMctx.strokeStyle=thinLineColor):30*g<bymax-bymin?0.01<Math.abs(Math.abs(Math.round10(Math.abs(i),f)/g%5-2.5)-2.5)&&(j=!1,bMctx.strokeStyle=thinLineColor):10*g<bymax-bymin&&0.01<Math.abs(Math.abs(Math.round10(Math.abs(i),f)/g%2-1)-1)&&(j=!1,bMctx.strokeStyle=thinLineColor)):bMctx.strokeStyle=thinLineColor,bMctx.beginPath(),bMctx.moveTo(h,btransy),bMctx.lineTo(h,bwidth+btransy),bMctx.stroke(),j){var l=bheight-bheight*-bymin/(bymax-bymin)+btransy;if(l<bheight+btransy&&l>btransy){var m=Math.round10(i,f)+"";bMctx.textAlign="right",bMctx.fillText(m,h-3,l+14)}}}for(i=Math.round10(bymin,f)+g;i<Math.round10(bymax,f)-g/2;i+=g){var o=Math.round10(bheight-bheight*(i-bymin)/(bymax-bymin))+btransy+0.5,j=!1;if(bMctx.lineWidth=1,Math.abs(i)<g/100?(bMctx.strokeStyle=axesColor,bMctx.lineWidth=2):Math.abs(Math.round10(i,f)-i)<g/100?(bMctx.strokeStyle=thickLineColor,j=!0,60*g<bxmax-bxmin?0.01<Math.abs(Math.abs(Math.round10(Math.abs(i),f)/g%10-5)-5)&&(j=!1,bMctx.strokeStyle=thinLineColor):30*g<bxmax-bxmin?0.01<Math.abs(Math.abs(Math.round10(Math.abs(i),f)/g%5-2.5)-2.5)&&(j=!1,bMctx.strokeStyle=thinLineColor):10*g<bxmax-bxmin&&0.01<Math.abs(Math.abs(Math.round10(Math.abs(i),f)/g%2-1)-1)&&(j=!1,bMctx.strokeStyle=thinLineColor)):bMctx.strokeStyle=thinLineColor,bMctx.beginPath(),bMctx.moveTo(btransx,o),bMctx.lineTo(btransx+bwidth,o),bMctx.stroke(),j){var p=bwidth*-bxmin/(bxmax-bxmin)+btransx;if(p<bwidth+btransx&&p>btransx){var m=Math.round10(i,f)+"";bMctx.textAlign="right",bMctx.fillText(m,p-3,o+14)}}}for(i=0;i<base.length-1;i++){var q=base[i],r=base[i+1];bLine(q[0],q[1],r[0],r[1])}}function resetMZoom(){mxmin=-1,mxmax=1,mymin=-1,mymax=1,redrawBM()}function mZoom(f,g,h,j){if(!((-1e3>mxmin||1e3<mxmax||-1e3>mymin||1e3<mymax)&&0<h||1e-3>mxmax-mxmin&&0>h)&&!(f<mtransx||f>mtransx+mwidth||g<mtransy||g>mtransy+mheight)){j.preventDefault();var l=(f-mtransx)/mwidth*(mxmax-mxmin)+mxmin,m=(mheight-g+mtransy)/mheight*(mymax-mymin)+mymin;mxmin=Math.pow(zoomrate,h)*(mxmin-l)+l,mxmax=Math.pow(zoomrate,h)*(mxmax-l)+l,mymin=Math.pow(zoomrate,h)*(mymin-m)+m,mymax=Math.pow(zoomrate,h)*(mymax-m)+m}}function mLine(f,g,h,j){return bMctx.strokeStyle="#FF0000",bMctx.lineWidth=2,bMctx.save(),bMctx.beginPath(),bMctx.moveTo(mtransx,mtransy),bMctx.lineTo(mtransx+mwidth,mtransy),bMctx.lineTo(mtransx+mwidth,mtransy+mwidth),bMctx.lineTo(mtransx,mtransy+mwidth),bMctx.lineTo(mtransx,mtransy),bMctx.clip(),bMctx.beginPath(),bMctx.moveTo(mwidth*(f-mxmin)/(mxmax-mxmin)+mtransx,mheight*(1-(g-mymin)/(mymax-mymin))+mtransy),bMctx.lineTo(mwidth*(h-mxmin)/(mxmax-mxmin)+mtransx,mheight*(1-(j-mymin)/(mymax-mymin))+mtransy),bMctx.stroke(),bMctx.lineWidth=1,void bMctx.restore()}function drawMotifGrid(){bMctx.textAlign="left",bMctx.font=titleFont,bMctx.fillText("Motif",mtransx+10,40),bMctx.font=axisFont;var f=Math.floor(Math.log10(mxmax-mxmin))-1,g=Math.pow(10,f);for(i=Math.round10(mxmin,f)+g;i<Math.round10(mxmax,f)-g/2;i+=g){var h=Math.round(mwidth*(i-mxmin)/(mxmax-mxmin))+mtransx+0.5,j=!1;if(bMctx.lineWidth=1,Math.abs(i)<g/100?(bMctx.strokeStyle=axesColor,bMctx.lineWidth=2):Math.abs(Math.round10(i,f)-i)<g/100?(bMctx.strokeStyle=thickLineColor,j=!0,60*g<mymax-mymin&&0.01<Math.abs(Math.abs(Math.round10(Math.abs(i),f)/g%10-5)-5)&&(j=!1,bMctx.strokeStyle=thinLineColor),30*g<mymax-mymin?0.01<Math.abs(Math.abs(Math.round10(Math.abs(i),f)/g%5-2.5)-2.5)&&(j=!1,bMctx.strokeStyle=thinLineColor):10*g<mymax-mymin&&0.01<Math.abs(Math.abs(Math.round10(Math.abs(i),f)/g%2-1)-1)&&(j=!1,bMctx.strokeStyle=thinLineColor)):bMctx.strokeStyle=thinLineColor,bMctx.beginPath(),bMctx.moveTo(h,mtransy),bMctx.lineTo(h,mwidth+mtransy),bMctx.stroke(),j){var l=mheight-mheight*-mymin/(mymax-mymin)+mtransy;if(l<mheight+mtransy&&l>mtransy){var m=Math.round10(i,f)+"";bMctx.textAlign="right",bMctx.fillText(m,h-3,l+14)}}}for(i=Math.round10(mymin,f)+g;i<Math.round10(mymax,f)-g/2;i+=g){var o=Math.round10(mheight-mheight*(i-mymin)/(mymax-mymin))+mtransy+0.5,j=!1;if(bMctx.lineWidth=1,Math.abs(i)<g/100?(bMctx.strokeStyle=axesColor,bMctx.lineWidth=2):Math.abs(Math.round10(i,f)-i)<g/100?(bMctx.strokeStyle=thickLineColor,j=!0,60*g<mxmax-mxmin&&0.01<Math.abs(Math.abs(Math.round10(Math.abs(i),f)/g%10-5)-5)&&(j=!1,bMctx.strokeStyle=thinLineColor),30*g<mxmax-mxmin?0.01<Math.abs(Math.abs(Math.round10(Math.abs(i),f)/g%5-2.5)-2.5)&&(j=!1,bMctx.strokeStyle=thinLineColor):10*g<mxmax-mxmin&&0.01<Math.abs(Math.abs(Math.round10(Math.abs(i),f)/g%2-1)-1)&&(j=!1,bMctx.strokeStyle=thinLineColor)):bMctx.strokeStyle=thinLineColor,bMctx.beginPath(),bMctx.moveTo(mtransx,o),bMctx.lineTo(mtransx+mwidth,o),bMctx.stroke(),j){var p=mwidth*-mxmin/(mxmax-mxmin)+mtransx;if(p<mwidth+mtransx&&p>mtransx){var m=Math.round10(i,f)+"";bMctx.textAlign="right",bMctx.fillText(m,p-3,o+14)}}}for(i=0;i<pattern.length-1;i++){var q=gPairs[i],r=gPairs[i+1];mLine(q[0],q[1],r[0],r[1])}}function redrawBM(){clearBMCanvas(),drawBaseGrid(),drawMotifGrid()}function updateBM(){var f=document.getElementById("baseinput").value,g=document.getElementById("motifinput").value;f=f.replace(/\[/g,"(").replace(/\{/g,"(").replace(/\]/g,")").replace(/\}/g,")").replace(/ /g,"").trim("(").trim(")"),g=g.replace(/\[/g,"(").replace(/\{/g,"(").replace(/\]/g,")").replace(/\}/g,")").replace(/ /g,"").trim("(").trim(")");var h=f.split("),("),j=1!=h.length,l=[];for(i=0;i<h.length;i++){var m=h[i].split(",");try{var o=parseFloat(m[0]),p=parseFloat(m[1]);if(!isNaN(o)&&!isNaN(p))l.push([o,p]);else throw""}catch(C){j=!1;break}}j?(document.getElementById("baseinput").style.backgroundColor="#FFFFFF",base=l):document.getElementById("baseinput").style.backgroundColor="#FF9184";var q=g.split("),("),j=1!=q.length,l=[],r=0;for(i=0;i<q.length;i++){motif=q[i].split(",");try{var o=parseFloat(motif[0]),p=parseFloat(motif[1]);if(0!=l.length){var t=l[l.length-1],u=Math.hypot(t[0]-o,t[1]-p);u>r&&(r=u)}if(!isNaN(o)&&!isNaN(p))l.push([o,p]);else throw""}catch(C){j=!1;break}}try{var v=Math.hypot(l[l.length-1][0]-l[0][0],l[l.length-1][1]-l[0][1])}catch(C){}if(r>0.9*v&&j?(document.getElementById("warningP").innerHTML="The motif cannot contain a line segment longer than its size.",j=!1,gPairs=l):document.getElementById("warningP").innerHTML="&nbsp;",!j)document.getElementById("motifinput").style.backgroundColor="#FF9184";else{document.getElementById("motifinput").style.backgroundColor="#FFFFFF";var z=[],A=[];for(i=0;i<l.length;i++)z.push([(l[i][0]-l[0][0])/v,(l[i][1]-l[0][1])/v]);var B=Math.atan2(z[z.length-1][1],z[z.length-1][0]);for(i=0;i<z.length;i++)A.push(rotatePoint(z[i],-B));pattern=A,gPairs=l}redrawBM()}var pattern=[[0,0],[0.5,0.5],[1,0]],base=[[-0.25,0],[0.25,0]],depthlimit=25,fractalColor="#333333",drawGridlines=!0,drawAxes=!0,gPairs=pattern,lastPausalDate,recallFinished=!0,gcSequence=[],startDate=new Date().getTime(),stop=!1;function clearCanvas(){ctx.clearRect(0,0,canvas.width,canvas.height)}function fLine(f,g,h,j){return ctx.beginPath(),ctx.moveTo(fwidth*(f-fxmin)/(fxmax-fxmin),fheight*(1-(g-fymin)/(fymax-fymin))),ctx.lineTo(fwidth*(h-fxmin)/(fxmax-fxmin),fheight*(1-(j-fymin)/(fymax-fymin))),void ctx.stroke()}function rotatePoint(f,g){var h=Math.sin(g),j=Math.cos(g);return[f[0]*j-f[1]*h,f[0]*h+f[1]*j]}function fitPattern(f,g){var h=[],j=Math.atan2(g[1]-f[1],g[0]-f[0]),l=Math.hypot(g[0]-f[0],g[1]-f[1]);for(w=0;w<pattern.length;w++){var m=pattern[w],o=rotatePoint(m,j);h.push([o[0]*l+f[0],o[1]*l+f[1]])}return h}function fRecurse(f,g,h){if(stop)return!1;if(f>=depthlimit){for(var j=0;j<g.length-1;j++){var l=g[j],m=g[j+1];fLine(l[0],l[1],m[0],m[1])}return}var o=0;for(f>=gcSequence.length-1&&(recallFinished=!0),recallFinished||(o=gcSequence[f]),j=o;j<g.length-1;j++){var l=g[j],m=g[j+1],p=Math.hypot(m[0]-l[0],m[1]-l[1]);if(p<(fxmax-fxmin)/canvas.width){fLine(l[0],l[1],m[0],m[1]);continue}if(p*=2,!(l[0]>fxmax+p&&m[0]>fxmax+p||l[0]<fxmin-p&&m[0]<fxmin-p||l[1]>fymax+p&&m[1]>fymax+p||l[1]<fymin-p&&m[1]<fymin-p)){var q=h.slice(0);if(q.push(j),lastPausalDate+30<new Date().getTime())return setTimeout(function(){lastPausalDate=new Date().getTime(),recallFinished=!1,document.getElementById("progress").innerHTML="Rendering Time: "+(lastPausalDate-startDate+" ms"),gcSequence=h.slice(),fRecurse(0,base,[])},15),!1;if(!1===fRecurse(f+1,fitPattern(l,m),q))return!1}}}var fxmin=-1,fxmax=1,fymin=-1,fymax=1,ftransx=0,ftransy=0,fwidth=1024,fheight=1024,sFRT=null;function drawFractalGrid(){var f=Math.floor(Math.log10(fxmax-fxmin))-1,g=Math.pow(10,f);for(i=Math.round10(fxmin,f)+g;i<Math.round10(fxmax,f)-g/2;i+=g){var h=Math.round(fwidth*(i-fxmin)/(fxmax-fxmin))+ftransx+0.5,j=!1;if(ctx.lineWidth=1,Math.abs(i)<g/100){if(ctx.strokeStyle=axesColor,ctx.lineWidth=2,!drawAxes){if(!drawGridlines)continue;ctx.strokeStyle=thickLineColor,ctx.beginPath(),ctx.moveTo(h,ftransy),ctx.lineTo(h,fwidth+ftransy),ctx.stroke();continue}}else if(Math.abs(Math.round10(i,f)-i)<g/100){if(!drawGridlines)continue;ctx.strokeStyle=thickLineColor,j=!0,60*g<fymax-fymin?0.01<Math.abs(Math.abs(Math.round10(Math.abs(i),f)/g%10-5)-5)&&(j=!1,ctx.strokeStyle=thinLineColor):30*g<fymax-fymin?0.01<Math.abs(Math.abs(Math.round10(Math.abs(i),f)/g%5-2.5)-2.5)&&(j=!1,ctx.strokeStyle=thinLineColor):10*g<fymax-fymin&&0.01<Math.abs(Math.abs(Math.round10(Math.abs(i),f)/g%2-1)-1)&&(j=!1,ctx.strokeStyle=thinLineColor)}else ctx.strokeStyle=thinLineColor;if(ctx.beginPath(),ctx.moveTo(h,ftransy),ctx.lineTo(h,fwidth+ftransy),ctx.stroke(),j&&drawAxes){var l=fheight-fheight*-fymin/(fymax-fymin)+ftransy;if(l<fheight+ftransy&&l>ftransy){var m=Math.round10(i,f)+"";ctx.textAlign="right",ctx.fillText(m,h-3,l+14)}}}for(i=Math.round10(fymin,f)+g;i<Math.round10(fymax,f)-g/2;i+=g){var o=Math.round10(fheight-fheight*(i-fymin)/(fymax-fymin))+ftransy+0.5,j=!1;if(ctx.lineWidth=1,Math.abs(i)<g/100){if(ctx.strokeStyle=axesColor,ctx.lineWidth=2,!drawAxes){if(!drawGridlines)continue;ctx.strokeStyle=thickLineColor,ctx.beginPath(),ctx.moveTo(ftransx,o),ctx.lineTo(ftransx+fwidth,o),ctx.stroke();continue}}else if(Math.abs(Math.round10(i,f)-i)<g/100){if(!drawGridlines)continue;ctx.strokeStyle=thickLineColor,j=!0,60*g<fxmax-fxmin?0.01<Math.abs(Math.abs(Math.round10(Math.abs(i),f)/g%10-5)-5)&&(j=!1,ctx.strokeStyle=thinLineColor):30*g<fxmax-fxmin?0.01<Math.abs(Math.abs(Math.round10(Math.abs(i),f)/g%5-2.5)-2.5)&&(j=!1,ctx.strokeStyle=thinLineColor):10*g<fxmax-fxmin&&0.01<Math.abs(Math.abs(Math.round10(Math.abs(i),f)/g%2-1)-1)&&(j=!1,ctx.strokeStyle=thinLineColor)}else ctx.strokeStyle=thinLineColor;if(ctx.beginPath(),ctx.moveTo(ftransx,o),ctx.lineTo(ftransx+fwidth,o),ctx.stroke(),j&&drawAxes){var p=fwidth*-fxmin/(fxmax-fxmin)+ftransx;if(p<fwidth+ftransx&&p>ftransx){var m=Math.round10(i,f)+"";ctx.textAlign="right",ctx.fillText(m,p-3,o+14)}}}}function drawFractal(){stop=!0,recallFinished=!0,clearCanvas(),lastPausalDate=new Date().getTime(),drawFractalGrid(),setTimeout(function(){stop=!1,ctx.strokeStyle=fractalColor,startDate=new Date().getTime(),fRecurse(0,base,[],!1)},40)}function resetFZoom(){fxmin=-1,fxmax=1,fymin=-1,fymax=1,drawFractal()}function fZoom(f,g,h,j){if((j.preventDefault(),!((-1e3>fxmin||1e3<fxmax||-1e3>fymin||1e3<fymax)&&0<h||1e-3>fxmax-fxmin&&0>h))&&!(f<ftransx||f>ftransx+fwidth||g<ftransy||g>ftransy+fheight)){var l=(f-ftransx)/fwidth*(fxmax-fxmin)+fxmin,m=(fheight-g+ftransy)/fheight*(fymax-fymin)+fymin;fxmin=Math.pow(zoomrate,h)*(fxmin-l)+l,fxmax=Math.pow(zoomrate,h)*(fxmax-l)+l,fymin=Math.pow(zoomrate,h)*(fymin-m)+m,fymax=Math.pow(zoomrate,h)*(fymax-m)+m}}var fdragStartX,fdragStartY,tempfxmin,tempfymin,tempfxmax,tempfymax,flastX=512,flastY=512;canvas.addEventListener("mousedown",function(f){if(!(flastX<ftransx||flastX>ftransx+fwidth||flastY<ftransy||flastY>ftransy+fheight)){try{clearTimeout(sFRT)}catch(g){}document.body.style.mozUserSelect=document.body.style.webkitUserSelect=document.body.style.userSelect="none",lastX=f.offsetX||f.pageX-canvas.offsetLeft,lastY=f.offsetY||f.pageY-canvas.offsetTop,fdragStartX=(flastX-ftransx)/fwidth*(fxmax-fxmin)+fxmin,fdragStartY=(fheight-flastY+ftransy)/fheight*(fymax-fymin)+fymin,tempfxmin=fxmin,tempfymin=fymin,tempfxmax=fxmax,tempfymax=fymax}},!1),canvas.addEventListener("mousemove",function(f){if(flastX=f.offsetX||f.pageX-canvas.offsetLeft,flastY=f.offsetY||f.pageY-canvas.offsetTop,fdragStartX){try{clearTimeout(sFRT)}catch(j){}var g=(flastX-ftransx)/fwidth*(tempfxmax-tempfxmin)+tempfxmin,h=(fheight-flastY+ftransy)/fheight*(tempfymax-tempfymin)+tempfymin;if(-1e3>tempfxmin-g+fdragStartX||1e3<tempfxmax-g+fdragStartX||-1e3>tempfymin-h+fdragStartY||1e3<tempfymax-h+fdragStartY)return;fxmin=tempfxmin-g+fdragStartX,fymin=tempfymin-h+fdragStartY,fxmax=tempfxmax-g+fdragStartX,fymax=tempfymax-h+fdragStartY,clearCanvas(),drawFractalGrid()}},!1),canvas.addEventListener("mouseup",function(){fdragStartX=null,fdragStartY=null,drawFractal()},!1),canvas.onwheel=function(f){var g=f.wheelDelta?f.wheelDelta/40:f.detail?-f.detail:0;if(g)if(fZoom(f.offsetX,f.offsetY,g,f),6>depthlimit)drawFractal();else{clearCanvas(),drawFractalGrid();try{clearTimeout(sFRT)}catch(h){}sFRT=setTimeout(drawFractal,10*depthlimit)}};function updateIterations(){depthlimit=document.getElementById("iterations").value,drawFractal()}function updateColor(){var f=document.getElementById("color").value.replace(/ /g,"");/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(f)?(fractalColor=f,document.getElementById("color").style.backgroundColor="#FFFFFF"):document.getElementById("color").style.backgroundColor="#FF9184";try{clearTimeout(sFRT)}catch(g){}sFRT=setTimeout(drawFractal,500)}function updateDrawGrid(){drawGridlines=document.getElementById("drawGrid").checked,drawFractal()}function updateDrawAxes(){drawAxes=document.getElementById("drawAxes").checked,drawFractal()}function stopDrawing(){stop=!0}window.onload=function(){drawFractal(),drawBaseGrid(),drawMotifGrid()};
